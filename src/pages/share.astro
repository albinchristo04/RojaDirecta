---
import Layout from '../layouts/Layout.astro';
import { getMatches } from '../utils/data';

const matches = await getMatches();
const title = "Telegram Sharing Tool - Roja Directa En Vivo";

// Format the full list for the textarea
const today = new Date().toLocaleDateString('es-ES', { day: 'numeric', month: 'long' });
let fullListText = `âš½ï¸ *PARTIDOS DE HOY - ${today.toUpperCase()}* âš½ï¸\n\n`;

matches.forEach(match => {
    fullListText += `ðŸ•’ ${match.time} | ${match.title}\nðŸ”— https://www.rojadirectaenvivo.live/partido/${match.slug}/\n\n`;
});

fullListText += `ðŸš€ *Ver todos los partidos aquÃ­:* https://www.rojadirectaenvivo.live/`;
---

<Layout title={title} headerTitle="TELEGRAM SHARING TOOL">
    <div class="container">
        <div id="container-56c436d985de560b2b365e820e0834f8" style="margin: 1rem 0; display: flex; justify-content: center;"></div>

        <div class="tool-box">
            <div class="tool-header">
                <h2>Daily Schedule Generator</h2>
                <p>Generate a complete list of today's matches for Telegram.</p>
            </div>

            <div class="bulk-section">
                <div class="bulk-header">
                    <h3>Full Schedule Text</h3>
                    <div class="bulk-actions">
                        <button class="btn-tool copy" onclick="copyBulkText()">Copy Full List</button>
                        <a 
                            href={`https://t.me/share/url?url=${encodeURIComponent('https://www.rojadirectaenvivo.live/')}&text=${encodeURIComponent(fullListText)}`} 
                            target="_blank" 
                            class="btn-tool telegram"
                        >
                            Share Full List
                        </a>
                    </div>
                </div>
                <textarea id="bulk-text" readonly>{fullListText}</textarea>
            </div>

            <div class="ad-container" style="margin: 1rem 0; display: flex; justify-content: center;">
                <script type="text/javascript">
                    atOptions = {
                        'key' : '91ef85b010052beea3ccc6fadd182c5e',
                        'format' : 'iframe',
                        'height' : 50,
                        'width' : 320,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="https://www.highperformanceformat.com/91ef85b010052beea3ccc6fadd182c5e/invoke.js"></script>
            </div>

            <div class="divider">
                <span>OR SHARE INDIVIDUAL MATCHES</span>
            </div>


            <div class="search-box">
                <input type="text" id="match-search" placeholder="Search match or league..." />
            </div>

            <div class="matches-list-tool">
                {matches.map((match) => (
                    <div class="share-item" data-title={match.title.toLowerCase()} data-league={match.league.toLowerCase()}>
                        <div class="share-info">
                            <span class="s-time">{match.time}</span>
                            <span class="s-league">{match.league}</span>
                            <h3 class="s-title">{match.title}</h3>
                        </div>
                        <div class="share-actions">
                            <button 
                                class="btn-tool copy" 
                                data-url={`https://www.rojadirectaenvivo.live/partido/${match.slug}/`}
                                onclick="copyToClipboard(this)"
                            >
                                Copy Link
                            </button>
                            <a 
                                href={`https://t.me/share/url?url=${encodeURIComponent(`https://www.rojadirectaenvivo.live/partido/${match.slug}/`)}&text=${encodeURIComponent(`âš½ï¸ VER EN VIVO: ${match.title}\n\nDisfruta del partido gratis aquÃ­ ðŸ‘‡`)}`} 
                                target="_blank" 
                                class="btn-tool telegram"
                            >
                                Share Telegram
                            </a>
                        </div>
                    </div>
                ))}
            </div>
        </div>

        <div class="ad-container" style="margin: 2rem 0; display: flex; justify-content: center;">
            <script type="text/javascript">
                atOptions = {
                    'key' : '0669cb9f720396db47ff6c5c8e8b7a9e',
                    'format' : 'iframe',
                    'height' : 250,
                    'width' : 300,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="https://www.highperformanceformat.com/0669cb9f720396db47ff6c5c8e8b7a9e/invoke.js"></script>
        </div>
    </div>

</Layout>

<style>
    .tool-box {
        margin-top: 2rem;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        color: #333;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        margin-bottom: 4rem;
    }

    .tool-header {
        background: #1a1a1a;
        color: white;
        padding: 2rem;
        text-align: center;
        border-bottom: 4px solid #d32f2f;
    }

    .tool-header h2 {
        color: #ffc107;
        margin-bottom: 0.5rem;
    }

    .bulk-section {
        padding: 2rem;
        background: #fdfdfd;
        border-bottom: 1px solid #eee;
    }

    .bulk-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .bulk-header h3 {
        font-size: 1rem;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .bulk-actions {
        display: flex;
        gap: 0.5rem;
    }

    textarea {
        width: 100%;
        height: 250px;
        padding: 1rem;
        border-radius: 8px;
        border: 2px solid #eee;
        font-family: 'Courier New', Courier, monospace;
        font-size: 0.9rem;
        background: #f9f9f9;
        resize: none;
        outline: none;
    }

    textarea:focus {
        border-color: #d32f2f;
    }

    .divider {
        text-align: center;
        padding: 1rem;
        background: #f4f4f4;
        position: relative;
    }

    .divider span {
        background: #f4f4f4;
        padding: 0 1rem;
        font-size: 0.75rem;
        font-weight: 800;
        color: #999;
    }

    .search-box {
        padding: 1.5rem;
        background: white;
        border-bottom: 1px solid #eee;
    }

    #match-search {
        width: 100%;
        padding: 12px 20px;
        border-radius: 8px;
        border: 2px solid #ddd;
        font-size: 1rem;
        outline: none;
        transition: border-color 0.2s;
    }

    #match-search:focus {
        border-color: #d32f2f;
    }

    .matches-list-tool {
        max-height: 400px;
        overflow-y: auto;
    }

    .share-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.25rem 2rem;
        border-bottom: 1px solid #eee;
        transition: background 0.2s;
    }

    .share-item:hover {
        background: #fafafa;
    }

    .share-info {
        flex: 1;
    }

    .s-time {
        display: inline-block;
        background: #333;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .s-league {
        font-size: 0.75rem;
        color: #d32f2f;
        font-weight: 800;
        text-transform: uppercase;
        margin-left: 0.5rem;
    }

    .s-title {
        font-size: 1.1rem;
        font-weight: 700;
    }

    .share-actions {
        display: flex;
        gap: 0.75rem;
    }

    .btn-tool {
        padding: 10px 16px;
        border-radius: 6px;
        font-weight: 700;
        font-size: 0.85rem;
        cursor: pointer;
        border: none;
        transition: transform 0.1s;
        text-align: center;
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    .btn-tool:active {
        transform: scale(0.95);
    }

    .copy {
        background: #eee;
        color: #333;
    }

    .telegram {
        background: #0088cc;
        color: white;
    }

    @media (max-width: 768px) {
        .bulk-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        .bulk-actions {
            width: 100%;
        }
        .share-item {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        .share-actions {
            width: 100%;
        }
        .btn-tool {
            flex: 1;
        }
    }
</style>

<script is:inline>
    function copyBulkText() {
        const textArea = document.getElementById('bulk-text');
        textArea.select();
        document.execCommand('copy');
        
        const btn = event.target;
        const originalText = btn.innerText;
        btn.innerText = 'Copied!';
        btn.style.background = '#4caf50';
        btn.style.color = 'white';
        setTimeout(() => {
            btn.innerText = originalText;
            btn.style.background = '#eee';
            btn.style.color = '#333';
        }, 2000);
    }

    function copyToClipboard(btn) {
        const url = btn.getAttribute('data-url');
        navigator.clipboard.writeText(url).then(() => {
            const originalText = btn.innerText;
            btn.innerText = 'Copied!';
            btn.style.background = '#4caf50';
            btn.style.color = 'white';
            setTimeout(() => {
                btn.innerText = originalText;
                btn.style.background = '#eee';
                btn.style.color = '#333';
            }, 2000);
        });
    }

    // Search functionality
    const searchInput = document.getElementById('match-search');
    const items = document.querySelectorAll('.share-item');

    if (searchInput) {
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            items.forEach(item => {
                const title = item.getAttribute('data-title');
                const league = item.getAttribute('data-league');
                if (title.includes(term) || league.includes(term)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    }
</script>
